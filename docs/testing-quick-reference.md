# ãƒ†ã‚¹ãƒˆã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

## æ¦‚è¦

CI-Helperãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ãƒ†ã‚¹ãƒˆä½œæˆãƒ»ç¶­æŒã®ãŸã‚ã®ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚¬ã‚¤ãƒ‰ã€‚æ—¥å¸¸çš„ãªé–‹ç™ºä½œæ¥­ã§ç´ æ—©ãå‚ç…§ã§ãã‚‹ã‚ˆã†ã€é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

## ğŸš€ æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’æ›¸ãå‰ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆã§åŒæ§˜ã®æ©Ÿèƒ½ãŒã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆå¯¾è±¡ãŒãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‹ï¼ˆå˜ç´”ãªã‚²ãƒƒã‚¿ãƒ¼/ã‚»ãƒƒã‚¿ãƒ¼ã¯é¿ã‘ã‚‹ï¼‰
- [ ] å¤–éƒ¨ä¾å­˜é–¢ä¿‚ã‚’ç‰¹å®šã—ã€ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ã‚’æ±ºå®š
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã‚‚å«ã‚ã¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¨­è¨ˆ
- [ ] ãƒ†ã‚¹ãƒˆåãŒæ©Ÿèƒ½ã‚’æ˜ç¢ºã«è¡¨ç¾ã—ã¦ã„ã‚‹ã‹ç¢ºèª

## ğŸ“ ãƒ†ã‚¹ãƒˆå‘½åè¦å‰‡

```python
# âœ… è‰¯ã„ä¾‹: æ©Ÿèƒ½ã¨æ¡ä»¶ãŒæ˜ç¢º
def test_calculate_risk_with_high_confidence_returns_low_risk():
    pass

def test_load_config_file_raises_error_when_file_not_found():
    pass

def test_pattern_matching_returns_empty_list_for_no_matches():
    pass

# âŒ æ‚ªã„ä¾‹: æ›–æ˜§ã§ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‹ä¸æ˜
def test_calculate():
    pass

def test_config():
    pass

def test_pattern():
    pass
```

## ğŸ¯ ãƒ¢ãƒƒã‚¯ä½¿ç”¨ã®åˆ¤æ–­åŸºæº–

| å¯¾è±¡ | ãƒ¢ãƒƒã‚¯ã™ã‚‹ | ç†ç”± |
|------|-----------|------|
| ãƒ•ã‚¡ã‚¤ãƒ«I/O | âœ… | å®Ÿè¡Œé€Ÿåº¦ã€ãƒ†ã‚¹ãƒˆç‹¬ç«‹æ€§ |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ | âœ… | å¤–éƒ¨ä¾å­˜ã€å®Ÿè¡Œé€Ÿåº¦ |
| æ™‚é–“é–¢æ•° | âœ… | äºˆæ¸¬å¯èƒ½æ€§ã€å†ç¾æ€§ |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | âœ… | ãƒ†ã‚¹ãƒˆç‹¬ç«‹æ€§ã€é€Ÿåº¦ |
| ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ | âŒ | ãƒ†ã‚¹ãƒˆå¯¾è±¡ãã®ã‚‚ã® |
| æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | âŒ | ä¿¡é ¼æ€§ãŒé«˜ã„ |
| å˜ç´”ãªãƒ‡ãƒ¼ã‚¿æ§‹é€  | âŒ | ãƒ¢ãƒƒã‚¯ã®ä¾¡å€¤ãŒä½ã„ |

## ğŸ”§ ã‚ˆãä½¿ã†ãƒ¢ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®ãƒ¢ãƒƒã‚¯

```python
from unittest.mock import mock_open, patch

# ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
@patch('builtins.open', mock_open(read_data='{"key": "value"}'))
@patch('pathlib.Path.exists', return_value=True)
def test_file_loading(mock_exists, mock_file):
    # ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯
    pass

# ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿
@patch('builtins.open', mock_open())
@patch('pathlib.Path.mkdir')
def test_file_writing(mock_mkdir, mock_file):
    # ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯
    pass
```

### æ™‚é–“ã®ãƒ¢ãƒƒã‚¯

```python
@patch('time.time')
def test_time_dependent_function(mock_time):
    mock_time.return_value = 1000  # å›ºå®šæ™‚åˆ»
    # ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯
    pass
```

### APIå‘¼ã³å‡ºã—ã®ãƒ¢ãƒƒã‚¯

```python
@patch('httpx.post')
def test_api_call(mock_post):
    mock_post.return_value.json.return_value = {"result": "success"}
    mock_post.return_value.status_code = 200
    # ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯
    pass
```

## ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥ï¼‰

| å„ªå…ˆåº¦ | ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ | å¯¾è±¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾‹ |
|--------|----------------|------------------|
| ğŸ”´ é«˜ | 80%ä»¥ä¸Š | pattern_engine.py, fix_generator.py, risk_calculator.py |
| ğŸŸ¡ ä¸­ | 60%ä»¥ä¸Š | auto_fix_config.py, settings_manager.py, custom_pattern_manager.py |
| ğŸŸ¢ ä½ | 40%ä»¥ä¸Š | streaming_formatter.py, log_compressor.py |

## âš¡ ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
# åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
uv run pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
uv run pytest --cov=ci_helper --cov-report=term-missing

# ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆ
uv run pytest tests/unit/ai/test_risk_calculator.py

# å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ã¿å†å®Ÿè¡Œ
uv run pytest --lf

# ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ãƒã‚§ãƒƒã‚¯
uv run pytest --cov=ci_helper --cov-fail-under=70

# HTMLã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
uv run pytest --cov=ci_helper --cov-report=html
open htmlcov/index.html
```

## ğŸ› ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

### 1. ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼

```python
# å•é¡Œ: ModuleNotFoundError
# è§£æ±º: __init__.py ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªãƒ»ä½œæˆ
touch tests/__init__.py
touch tests/unit/__init__.py
touch tests/unit/ai/__init__.py
```

### 2. ãƒ¢ãƒƒã‚¯ãŒåŠ¹ã‹ãªã„

```python
# å•é¡Œ: ãƒ¢ãƒƒã‚¯ãŒé©ç”¨ã•ã‚Œãªã„
# åŸå› : ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

# âŒ æ‚ªã„ä¾‹
import ci_helper.utils.config
@patch('ci_helper.utils.config.load_file')  # åŠ¹ã‹ãªã„

# âœ… è‰¯ã„ä¾‹
@patch('ci_helper.utils.config.load_file')
def test_function(mock_load):
    import ci_helper.utils.config  # ãƒ†ã‚¹ãƒˆå†…ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```

### 3. æ™‚é–“ä¾å­˜ã®ãƒ†ã‚¹ãƒˆãŒä¸å®‰å®š

```python
# å•é¡Œ: æ™‚é–“ã«ä¾å­˜ã™ã‚‹ãƒ†ã‚¹ãƒˆãŒæ™‚ã€…å¤±æ•—
# è§£æ±º: time.time() ã‚’ãƒ¢ãƒƒã‚¯

@patch('time.time')
def test_cache_expiration(mock_time):
    mock_time.return_value = 1000  # å›ºå®šæ™‚åˆ»ã‚’ä½¿ç”¨
    # ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯
```

### 4. ãƒ†ã‚¹ãƒˆãŒé…ã„

```python
# å•é¡Œ: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã«æ™‚é–“ãŒã‹ã‹ã‚‹
# è§£æ±º: é‡ã„å‡¦ç†ã‚’ãƒ¢ãƒƒã‚¯

@patch('ci_helper.ai.expensive_operation')
def test_fast_version(mock_expensive):
    mock_expensive.return_value = "mocked_result"
    # é«˜é€Ÿãªãƒ†ã‚¹ãƒˆ
```

## ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç¢ºèªé …ç›®

- [ ] ãƒ†ã‚¹ãƒˆåãŒæ©Ÿèƒ½ã‚’æ˜ç¢ºã«è¡¨ç¾ã—ã¦ã„ã‚‹
- [ ] å¿…è¦ãªå¤–éƒ¨ä¾å­˜é–¢ä¿‚ãŒãƒ¢ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã‚‹
- [ ] ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒå…·ä½“çš„ã§æ„å‘³ãŒã‚ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
- [ ] å®Ÿè¡Œæ™‚é–“ãŒé©åˆ‡ï¼ˆ1ç§’ä»¥å†…ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã‚„ã™ã„

### æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®ç¢ºèªé …ç›®

- [ ] æ–°æ©Ÿèƒ½ã®ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒç›®æ¨™å€¤ã‚’æº€ãŸã—ã¦ã„ã‚‹
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] å¢ƒç•Œå€¤ãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹

## ğŸ¨ ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ãƒ†ã‚¹ãƒˆã®æ§‹é€ åŒ–

```python
class TestRiskCalculator:
    """ãƒªã‚¹ã‚¯è¨ˆç®—æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹"""
    
    def test_calculate_risk_with_valid_input(self):
        """æœ‰åŠ¹ãªå…¥åŠ›ã§ã®ãƒªã‚¹ã‚¯è¨ˆç®—ãƒ†ã‚¹ãƒˆ"""
        # Given: ãƒ†ã‚¹ãƒˆæ¡ä»¶ã®è¨­å®š
        calculator = RiskCalculator()
        
        # When: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å®Ÿè¡Œ
        result = calculator.calculate_risk(confidence=0.8, impact=0.6)
        
        # Then: çµæœã®æ¤œè¨¼
        assert result.level == RiskLevel.MEDIUM
        assert 0.4 <= result.score <= 0.8
```

### 2. ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®æ´»ç”¨

```python
@pytest.fixture
def sample_config():
    """ãƒ†ã‚¹ãƒˆç”¨è¨­å®šãƒ‡ãƒ¼ã‚¿"""
    return {
        "auto_fix": {
            "enabled": True,
            "confidence_threshold": 0.8
        }
    }

def test_with_fixture(sample_config):
    """ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ"""
    config = AutoFixConfig(sample_config)
    assert config.is_enabled()
```

### 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ãƒ†ã‚¹ãƒˆ

```python
@pytest.mark.parametrize("confidence,expected_risk", [
    (0.9, RiskLevel.LOW),
    (0.5, RiskLevel.MEDIUM),
    (0.2, RiskLevel.HIGH),
])
def test_risk_levels(confidence, expected_risk):
    """ä¿¡é ¼åº¦åˆ¥ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚¹ãƒˆ"""
    calculator = RiskCalculator()
    result = calculator.calculate_risk(confidence=confidence)
    assert result.level == expected_risk
```

## ğŸ“ˆ ã‚«ãƒãƒ¬ãƒƒã‚¸æ”¹å–„ã®ãƒ’ãƒ³ãƒˆ

### 1. æœªã‚«ãƒãƒ¼è¡Œã®ç‰¹å®š

```bash
# æœªã‚«ãƒãƒ¼è¡Œã‚’è¡¨ç¤º
uv run pytest --cov=ci_helper --cov-report=term-missing

# ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è©³ç´°
uv run pytest --cov=ci_helper.ai.risk_calculator --cov-report=term-missing
```

### 2. åŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆè¿½åŠ 

```python
# 1ã¤ã®ãƒ†ã‚¹ãƒˆã§è¤‡æ•°ã®åˆ†å²ã‚’ã‚«ãƒãƒ¼
def test_config_validation_comprehensive():
    """è¨­å®šæ¤œè¨¼ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ"""
    config = AutoFixConfig()
    
    # æœ‰åŠ¹ãªè¨­å®š
    assert config.validate({"confidence_threshold": 0.8}) is True
    
    # ç„¡åŠ¹ãªè¨­å®šï¼ˆè¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
    invalid_configs = [
        {"confidence_threshold": 1.5},  # ç¯„å›²å¤–
        {"confidence_threshold": "invalid"},  # å‹ã‚¨ãƒ©ãƒ¼
        {},  # å¿…é ˆé …ç›®ãªã—
    ]
    
    for invalid_config in invalid_configs:
        with pytest.raises(ConfigurationError):
            config.validate(invalid_config)
```

## ğŸ” ãƒ‡ãƒãƒƒã‚°ã®ãƒ’ãƒ³ãƒˆ

### 1. ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®è©³ç´°è¡¨ç¤º

```bash
# è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±
uv run pytest -v --tb=long

# æ¨™æº–å‡ºåŠ›ã‚‚è¡¨ç¤º
uv run pytest -s

# æœ€åˆã®å¤±æ•—ã§åœæ­¢
uv run pytest -x
```

### 2. ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ãƒ‡ãƒãƒƒã‚°

```python
def test_debug_example():
    """ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ†ã‚¹ãƒˆä¾‹"""
    calculator = RiskCalculator()
    
    # ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®å‡ºåŠ›
    print(f"Calculator state: {calculator.__dict__}")
    
    result = calculator.calculate_risk(confidence=0.8)
    
    # è©³ç´°ãªæ¤œè¨¼
    assert result is not None, "Result should not be None"
    assert hasattr(result, 'level'), "Result should have level attribute"
    print(f"Result: {result}")
```

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è©³ç´°ãªãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](./testing-guidelines.md)
- [ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](./mock-strategies.md)
- [ã‚«ãƒãƒ¬ãƒƒã‚¸ç¶­æŒã‚¬ã‚¤ãƒ‰](./coverage-maintenance.md)

---

**ğŸ’¡ ãƒ’ãƒ³ãƒˆ**: ã“ã®ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ã¦ã€ãƒ†ã‚¹ãƒˆä½œæˆæ™‚ã«ç´ æ—©ãå‚ç…§ã—ã¦ãã ã•ã„ã€‚
