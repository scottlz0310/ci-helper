# 修正テンプレートデータベース

このディレクトリには、CI-Helperのパターン認識エンジンが使用する修正テンプレートが含まれています。各テンプレートは、特定のエラーパターンに対する具体的な修正手順を定義しています。

## ディレクトリ構造

```
data/templates/
├── README.md                    # このファイル
├── template_index.json          # テンプレートインデックス
├── permission_fixes.json        # 権限関連の修正テンプレート
├── network_fixes.json          # ネットワーク関連の修正テンプレート
├── config_fixes.json           # 設定関連の修正テンプレート
├── build_fixes.json            # ビルド関連の修正テンプレート
├── dependency_fixes.json       # 依存関係関連の修正テンプレート
└── test_fixes.json             # テスト関連の修正テンプレート
```

## テンプレート構造

各修正テンプレートは以下の構造を持ちます：

```json
{
    "id": "template_id",
    "name": "テンプレート名",
    "description": "テンプレートの説明",
    "pattern_ids": ["対応するパターンID"],
    "fix_steps": [
        {
            "type": "file_modification|command|config_change",
            "description": "ステップの説明",
            "file_path": "対象ファイルパス（オプション）",
            "action": "create|append|replace（ファイル操作時）",
            "content": "変更内容（ファイル操作時）",
            "command": "実行コマンド（コマンド実行時）",
            "validation": "検証方法"
        }
    ],
    "risk_level": "low|medium|high",
    "estimated_time": "推定時間",
    "success_rate": 0.0-1.0,
    "prerequisites": ["前提条件のリスト"],
    "validation_steps": ["検証ステップのリスト"]
}
```

## リスクレベル

### Low（低リスク）

- 自動適用可能
- システムに大きな影響を与えない
- 簡単にロールバック可能
- 例：設定ファイルの追記、権限の変更

### Medium（中リスク）

- ユーザー確認推奨
- 一部のシステム動作に影響する可能性
- ロールバック可能だが注意が必要
- 例：依存関係の更新、ビルド設定の変更

### High（高リスク）

- 必ずユーザー確認が必要
- システム全体に影響する可能性
- 慎重なロールバック計画が必要
- 例：SSL設定の無効化、テストロジックの変更

## テンプレートの使用方法

1. **パターンマッチング**: エラーログがパターンにマッチした場合、対応するテンプレートが選択されます
2. **コンテキスト適用**: テンプレート内の変数（`{variable_name}`）が実際の値に置換されます
3. **前提条件チェック**: テンプレート実行前に前提条件が確認されます
4. **修正ステップ実行**: 各ステップが順次実行されます
5. **検証**: 修正後に検証ステップが実行されます

## 変数置換

テンプレート内では以下の変数が使用できます：

- `{file_path}`: 対象ファイルのパス
- `{package_name}`: パッケージ名
- `{workflow_file}`: ワークフローファイルのパス
- `{env_var_name}`: 環境変数名
- `{env_var_value}`: 環境変数の値
- `{hostname}`: ホスト名
- `{project_name}`: プロジェクト名
- その他、コンテキストに応じた変数

## カテゴリ別テンプレート

### Permission（権限）

- Docker権限エラー
- ファイル権限エラー
- sudo権限エラー

### Network（ネットワーク）

- 接続タイムアウト
- DNS解決失敗
- SSL証明書エラー

### Config（設定）

- YAML構文エラー
- GitHub Actions設定エラー
- 環境変数エラー
- アクション関連エラー

### Build（ビルド）

- コンパイルエラー
- Make/CMakeエラー
- Gradle/Mavenエラー
- NPMビルドエラー

### Dependency（依存関係）

- Python依存関係エラー
- Node.js依存関係エラー
- その他言語の依存関係エラー

### Test（テスト）

- テスト失敗
- テストタイムアウト
- カバレッジエラー

## 統計情報

- **総テンプレート数**: 27個
- **平均成功率**: 79%
- **平均修正時間**: 8.5分
- **最も信頼性の高いカテゴリ**: dependency（82%）
- **最も注意が必要なカテゴリ**: network（72%）

## カスタムテンプレートの追加

新しいテンプレートを追加する場合：

1. 適切なカテゴリファイルに追加
2. `template_index.json`を更新
3. パターンとテンプレートのマッピングを追加
4. テストケースを作成

## 注意事項

- テンプレートは定期的に更新され、成功率が追跡されます
- 高リスクテンプレートは特に慎重に使用してください
- 本番環境での使用前に必ずテスト環境で検証してください
- バックアップとロールバック機能を必ず有効にしてください

## 更新履歴

- v1.0.0 (2024-01-01): 初期テンプレートセット作成
  - 27個の基本テンプレートを実装
  - 6つのカテゴリに分類
  - リスクレベルと成功率を設定
