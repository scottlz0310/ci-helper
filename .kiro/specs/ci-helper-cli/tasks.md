# 実装計画

- [x] 1. プロジェクト構造とコア インターフェースのセットアップ

  - プロジェクト全体のディレクトリ構造を作成
  - pyproject.toml で uv tool install 対応の設定
  - 基本的なモジュール構造とインポート設定
  - _要件: 1.3, 2.4_

- [x] 2. 設定管理システムの実装

- [x] 2.1 設定ファイル読み込み機能の実装

  - TOML 設定ファイルの読み込み機能
  - 環境変数の読み込みと優先順位制御
  - 設定値の検証とデフォルト値の管理
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 2.2 設定テンプレート生成機能の実装

  - .actrc.example、ci-helper.toml.example、.env.example テンプレートの作成
  - init コマンドでのテンプレート生成ロジック
  - 既存ファイルの上書き確認機能
  - _要件: 2.1_

- [ ]\* 2.3 設定管理のユニットテスト作成

  - 設定ファイル読み込みのテスト
  - 優先順位制御のテスト
  - 検証機能のテスト
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 3. CLI フレームワークとコマンド構造の実装

- [x] 3.1 メイン CLI エントリーポイントの作成

  - Click を使用したマルチコマンドグループの実装
  - バージョン情報とヘルプ表示機能
  - グローバル設定の初期化
  - _要件: 1.1, 1.2_

- [x] 3.2 基本コマンドの実装（init、doctor）

  - init コマンド：設定ファイルテンプレート生成
  - doctor コマンド：環境依存関係チェック
  - 適切なヘルプメッセージとオプション定義
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ]\* 3.3 CLI コマンドのユニットテスト作成

  - 各コマンドの動作テスト
  - オプション処理のテスト
  - ヘルプ表示のテスト
  - _要件: 1.1, 1.2, 2.1, 2.2, 2.3, 2.4_

- [x] 4. 環境検証とエラーハンドリングシステムの実装

- [x] 4.1 依存関係チェック機能の実装

  - act コマンドの存在確認
  - Docker デーモンの起動状態チェック
  - .github/workflows ディレクトリの存在確認
  - 各チェックの詳細なエラーメッセージ
  - _要件: 8.1, 8.2, 8.3_

- [x] 4.2 包括的エラーハンドリングの実装

  - カスタム例外クラスの定義
  - エラー分類と適切なメッセージ表示
  - ユーザーフレンドリーなガイダンス提供
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]\* 4.3 エラーハンドリングのユニットテスト作成

  - 各種エラー条件のテスト
  - エラーメッセージの検証
  - 復旧処理のテスト
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 5. CI 実行エンジンの実装
- [ ] 5.1 act コマンド実行機能の実装

  - subprocess を使用した act 実行
  - ワークフロー指定とオプション処理
  - タイムアウト制御と実行結果キャプチャ
  - _要件: 3.1, 3.2_

- [ ] 5.2 ログ管理とファイル操作の実装

  - 実行ログの保存機能（タイムスタンプ付き）
  - ログディレクトリの管理
  - ログ一覧表示機能
  - _要件: 3.4, 3.5, 3.6_

- [ ] 5.3 test コマンドの実装

  - 全オプション（--workflow、--verbose、--format 等）の実装
  - ドライラン機能（既存ログ解析）
  - 詳細出力とログ保存制御
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ]\* 5.4 CI 実行エンジンのユニットテスト作成

  - act 実行のモックテスト
  - ログ保存機能のテスト
  - オプション処理のテスト
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [ ] 6. ログ解析と失敗抽出システムの実装
- [ ] 6.1 失敗パターン抽出機能の実装

  - 正規表現を使用したエラーパターンマッチング
  - スタックトレースとアサーション失敗の検出
  - コンテキストライン（エラー前後）の取得
  - _要件: 4.1, 4.2_

- [ ] 6.2 ログ解析とデータ構造の実装

  - ワークフローとジョブごとの失敗整理
  - 失敗情報のデータクラス定義
  - 複数ワークフロー対応の解析ロジック
  - _要件: 4.3, 4.4_

- [ ]\* 6.3 ログ解析のユニットテスト作成

  - 各種エラーパターンの抽出テスト
  - コンテキスト取得のテスト
  - データ構造の検証テスト
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [ ] 7. AI 用出力フォーマッターの実装
- [ ] 7.1 Markdown 形式フォーマッターの実装

  - 構造化された Markdown 出力
  - コードブロックと明確なセクション分け
  - 重要エラーのハイライト表示
  - _要件: 5.1, 5.5_

- [ ] 7.2 JSON 形式フォーマッターとトークン管理の実装

  - 機械可読な JSON 出力形式
  - tiktoken を使用したトークン数カウント
  - モデル制限チェックと警告表示
  - _要件: 5.2, 5.3, 5.4_

- [ ]\* 7.3 フォーマッターのユニットテスト作成

  - Markdown 出力の検証テスト
  - JSON 出力の検証テスト
  - トークン数カウントのテスト
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8. ログ比較と差分表示機能の実装
- [ ] 8.1 ログ比較エンジンの実装

  - 過去実行との結果比較機能
  - 新規エラー、解決済みエラーの分類
  - 差分表示とサマリー生成
  - _要件: 6.1, 6.2_

- [ ] 8.2 ログ履歴管理の実装

  - 実行履歴の保存と管理
  - logs コマンドでの履歴表示
  - 差分表示オプションの実装
  - _要件: 6.3, 6.4_

- [ ]\* 8.3 ログ比較のユニットテスト作成

  - 差分検出のテスト
  - 分類機能のテスト
  - 履歴管理のテスト
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [ ] 9. キャッシュ管理とクリーンアップ機能の実装
- [ ] 9.1 キャッシュ管理システムの実装

  - ログファイルのキャッシュ管理
  - 自動クリーンアップ機能
  - 容量制限と古いファイルの削除
  - _要件: 9.3_

- [ ] 9.2 clean コマンドの実装

  - キャッシュとログファイルの削除
  - 選択的削除オプション（--logs-only、--all）
  - 削除前の確認とサマリー表示
  - _要件: 9.1, 9.2, 9.4_

- [ ]\* 9.3 キャッシュ管理のユニットテスト作成

  - 自動クリーンアップのテスト
  - 削除機能のテスト
  - 容量制限のテスト
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ] 10. セキュリティとシークレット管理の実装
- [ ] 10.1 シークレット検出とフィルタリングの実装

  - ログ内のシークレットパターン検出
  - 出力時の自動サニタイゼーション
  - 設定ファイル内のシークレット検証
  - _要件: 10.2, 10.3, 10.4_

- [ ] 10.2 環境変数ベースの API キー管理の実装

  - 環境変数からの API キー読み取り
  - 設定ファイルでのシークレット記載禁止
  - act 実行時の安全なシークレット渡し
  - _要件: 10.1, 10.5_

- [ ]\* 10.3 セキュリティ機能のユニットテスト作成

  - シークレット検出のテスト
  - フィルタリング機能のテスト
  - 環境変数読み取りのテスト
  - _要件: 10.1, 10.2, 10.3, 10.4, 10.5_

- [ ] 11. 統合テストとドキュメント整備
- [ ] 11.1 統合テストの作成

  - 実際のワークフローファイルを使用した E2E テスト
  - コマンド間連携のテスト
  - エラーシナリオの統合テスト
  - _要件: 全要件の統合検証_

- [ ] 11.2 ドキュメントと README の作成

  - インストール手順とセットアップガイド
  - 使用方法とコマンドリファレンス
  - トラブルシューティングガイド
  - _要件: 2.3, 2.4, 8.1, 8.2, 8.3_

- [ ] 11.3 パッケージング と配布準備
  - pyproject.toml の最終調整
  - uv tool install での動作確認
  - CI/CD パイプラインの設定
  - _要件: 1.3_
